"""
How it Works (The Flow)
Local Machine: You run trigger_training.py.

API Call: Boto3 sends a request to AWS SageMaker API.

Spin Up: SageMaker finds an available ml.m5.large instance in the AWS Cloud.

Download: It pulls the official XGBoost Docker Image and downloads your train.csv from S3.

Inject: It copies your train_entrypoint.py inside the container.

Execute: It runs python train_entrypoint.py --max_depth 5 ....

Upload: When the script finishes, SageMaker takes the file saved in SM_MODEL_DIR (xgboost-model), zips it into model.tar.gz, and uploads it to your S3 bucket.

Teardown: The instance is terminated immediately (you stop paying).

"""

(.venv) bijut@b:~/aws_apps/fred_fintech_app$ python3 -m src.model.trigger_training
sagemaker.config INFO - Not applying SDK defaults from location: /etc/xdg/sagemaker/config.yaml
sagemaker.config INFO - Not applying SDK defaults from location: /home/bijut/.config/sagemaker/config.yaml
üöÄ Starting Training Job...
INFO:sagemaker:Creating training-job with name: sagemaker-xgboost-2026-01-10-07-09-03-065
2026-01-10 07:09:06 Starting - Starting the training job...
2026-01-10 07:09:21 Starting - Preparing the instances for training...
2026-01-10 07:09:44 Downloading - Downloading input data...
2026-01-10 07:10:29 Downloading - Downloading the training image......
2026-01-10 07:11:40 Training - Training image download completed. Training in progress.
2026-01-10 07:11:40 Uploading - Uploading generated training model/miniconda3/lib/python3.8/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import MultiIndex, Int64Index
[2026-01-10 07:11:28.345 ip-10-0-151-102.ec2.internal:7 INFO utils.py:28] RULE_JOB_STOP_SIGNAL_FILENAME: None
[2026-01-10 07:11:28.395 ip-10-0-151-102.ec2.internal:7 INFO profiler_config_parser.py:111] User has disabled profiler.
[2026-01-10:07:11:28:INFO] Imported framework sagemaker_xgboost_container.training
[2026-01-10:07:11:28:INFO] No GPUs detected (normal if no gpus installed)
[2026-01-10:07:11:28:INFO] Invoking user training script.
[2026-01-10:07:11:29:INFO] Module train_entrypoint does not provide a setup.py.
Generating setup.py
[2026-01-10:07:11:29:INFO] Generating setup.cfg
[2026-01-10:07:11:29:INFO] Generating MANIFEST.in
[2026-01-10:07:11:29:INFO] Installing module with the following command:
/miniconda3/bin/python3 -m pip install .
Processing /opt/ml/code
  Preparing metadata (setup.py): started
  Preparing metadata (setup.py): finished with status 'done'
Building wheels for collected packages: train-entrypoint
  Building wheel for train-entrypoint (setup.py): started
  Building wheel for train-entrypoint (setup.py): finished with status 'done'
  Created wheel for train-entrypoint: filename=train_entrypoint-1.0.0-py2.py3-none-any.whl size=11174 sha256=8b206e28a98dcf4471505e28032a319e5eded6b4519fbbc11b8fb9cc11bcdc31
  Stored in directory: /home/model-server/tmp/pip-ephem-wheel-cache-hi3vskbw/wheels/f3/75/57/158162e9eab7af12b5c338c279b3a81f103b89d74eeb911c00
Successfully built train-entrypoint
Installing collected packages: train-entrypoint
Successfully installed train-entrypoint-1.0.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
[2026-01-10:07:11:30:INFO] No GPUs detected (normal if no gpus installed)
[2026-01-10:07:11:30:INFO] Invoking user script
Training Env:
{
    "additional_framework_parameters": {},
    "channel_input_dirs": {
        "train": "/opt/ml/input/data/train"
    },
    "current_host": "algo-1",
    "framework_module": "sagemaker_xgboost_container.training:main",
    "hosts": [
        "algo-1"
    ],
    "hyperparameters": {
        "eta": "0.2",
        "max_depth": "5",
        "objective": "reg:squarederror"
    },
    "input_config_dir": "/opt/ml/input/config",
    "input_data_config": {
        "train": {
            "ContentType": "csv",
            "TrainingInputMode": "File",
            "S3DistributionType": "FullyReplicated",
            "RecordWrapperType": "None"
        }
    },
    "input_dir": "/opt/ml/input",
    "is_master": true,
    "job_name": "sagemaker-xgboost-2026-01-10-07-09-03-065",
    "log_level": 20,
    "master_hostname": "algo-1",
    "model_dir": "/opt/ml/model",
    "module_dir": "s3://fred-fintech-data-637423309379/sagemaker-xgboost-2026-01-10-07-09-03-065/source/sourcedir.tar.gz",
    "module_name": "train_entrypoint",
    "network_interface_name": "eth0",
    "num_cpus": 2,
    "num_gpus": 0,
    "output_data_dir": "/opt/ml/output/data",
    "output_dir": "/opt/ml/output",
    "output_intermediate_dir": "/opt/ml/output/intermediate",
    "resource_config": {
        "current_host": "algo-1",
        "current_instance_type": "ml.m5.large",
        "current_group_name": "homogeneousCluster",
        "hosts": [
            "algo-1"
        ],
        "instance_groups": [
            {
                "instance_group_name": "homogeneousCluster",
                "instance_type": "ml.m5.large",
                "hosts": [
                    "algo-1"
                ]
            }
        ],
        "network_interface_name": "eth0",
        "topology": null
    },
    "user_entry_point": "train_entrypoint.py"
}
Environment variables:
SM_HOSTS=["algo-1"]
SM_NETWORK_INTERFACE_NAME=eth0
SM_HPS={"eta":"0.2","max_depth":"5","objective":"reg:squarederror"}
SM_USER_ENTRY_POINT=train_entrypoint.py
SM_FRAMEWORK_PARAMS={}
SM_RESOURCE_CONFIG={"current_group_name":"homogeneousCluster","current_host":"algo-1","current_instance_type":"ml.m5.large","hosts":["algo-1"],"instance_groups":[{"hosts":["algo-1"],"instance_group_name":"homogeneousCluster","instance_type":"ml.m5.large"}],"network_interface_name":"eth0","topology":null}
SM_INPUT_DATA_CONFIG={"train":{"ContentType":"csv","RecordWrapperType":"None","S3DistributionType":"FullyReplicated","TrainingInputMode":"File"}}
SM_OUTPUT_DATA_DIR=/opt/ml/output/data
SM_CHANNELS=["train"]
SM_CURRENT_HOST=algo-1
SM_MODULE_NAME=train_entrypoint
SM_LOG_LEVEL=20
SM_FRAMEWORK_MODULE=sagemaker_xgboost_container.training:main
SM_INPUT_DIR=/opt/ml/input
SM_INPUT_CONFIG_DIR=/opt/ml/input/config
SM_OUTPUT_DIR=/opt/ml/output
SM_NUM_CPUS=2
SM_NUM_GPUS=0
SM_MODEL_DIR=/opt/ml/model
SM_MODULE_DIR=s3://fred-fintech-data-637423309379/sagemaker-xgboost-2026-01-10-07-09-03-065/source/sourcedir.tar.gz
SM_TRAINING_ENV={"additional_framework_parameters":{},"channel_input_dirs":{"train":"/opt/ml/input/data/train"},"current_host":"algo-1","framework_module":"sagemaker_xgboost_container.training:main","hosts":["algo-1"],"hyperpar
ameters":{"eta":"0.2","max_depth":"5","objective":"reg:squarederror"},"input_config_dir":"/opt/ml/input/config","input_data_config":{"train":{"ContentType":"csv","RecordWrapperType":"None","S3DistributionType":"FullyReplicated"
,"TrainingInputMode":"File"}},"input_dir":"/opt/ml/input","is_master":true,"job_name":"sagemaker-xgboost-2026-01-10-07-09-03-065","log_level":20,"master_hostname":"algo-1","model_dir":"/opt/ml/model","module_dir":"s3://fred-fin
tech-data-637423309379/sagemaker-xgboost-2026-01-10-07-09-03-065/source/sourcedir.tar.gz","module_name":"train_entrypoint","network_interface_name":"eth0","num_cpus":2,"num_gpus":0,"output_data_dir":"/opt/ml/output/data","outpu
t_dir":"/opt/ml/output","output_intermediate_dir":"/opt/ml/output/intermediate","resource_config":{"current_group_name":"homogeneousCluster","current_host":"algo-1","current_instance_type":"ml.m5.large","hosts":["algo-1"],"instance_groups":[{"hosts":["algo-1"],"instance_group_name":"homogeneousCluster","instance_type":"ml.m5.large"}],"network_interface_name":"eth0","topology":null},"user_entry_point":"train_entrypoint.py"}
SM_USER_ARGS=["--eta","0.2","--max_depth","5","--objective","reg:squarederror"]
SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
SM_CHANNEL_TRAIN=/opt/ml/input/data/train
SM_HP_ETA=0.2
SM_HP_MAX_DEPTH=5
SM_HP_OBJECTIVE=reg:squarederror
PYTHONPATH=/miniconda3/bin:/:/miniconda3/lib/python/site-packages/xgboost/dmlc-core/tracker:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
Invoking script with the following command:
/miniconda3/bin/python3 -m train_entrypoint --eta 0.2 --max_depth 5 --objective reg:squarederror
/miniconda3/lib/python3.8/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import MultiIndex, Int64Index
Reading data from /opt/ml/input/data/train/train.csv
Training shape: (6866, 4)
/miniconda3/lib/python3.8/site-packages/xgboost/data.py:262: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  elif isinstance(data.columns, (pd.Int64Index, pd.RangeIndex)):
Starting training...
Model saved to /opt/ml/model/xgboost-model

2026-01-10 07:11:54 Completed - Training job completed
Training seconds: 129
Billable seconds: 129
üìù Registering Model...
INFO:sagemaker.image_uris:Ignoring unnecessary instance type: ml.t2.medium.
INFO:sagemaker:Created S3 bucket: sagemaker-us-east-1-637423309379
‚úÖ Model Registered: arn:aws:sagemaker:us-east-1:637423309379:model-package/FredRecessionModels/1
(.venv) bijut@b:~/aws_apps/fred_fintech_app$

